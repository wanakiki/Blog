<!DOCTYPE html>
<html lang="zh-cn">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Mogeko">
  <meta name="description" content="Mogeko çš„ä¸ªäººåšå®¢">
  <meta name="keywords" content="blog, KMS, Hugo, GNU/Linux, Linux, Ubuntu, Rusty Lake: Roots, Hollow Knight, ç©ºæ´éª‘å£«">
  
  <link rel="prev" href="https://mogeko.me/2019/043/" />
  <link rel="next" href="https://mogeko.me/2019/045/" />
  <link rel="canonical" href="https://mogeko.me/2019/044/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Rust ä¸­çš„é”™è¯¯å¤„ç† | Mogeko`s Blog
       
  </title>
  <meta name="title" content="Rust ä¸­çš„é”™è¯¯å¤„ç† | Mogeko`s Blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https://mogeko.me"
    },
    "articleSection" : "posts",
    "name" : "Rust ä¸­çš„é”™è¯¯å¤„ç†",
    "headline" : "Rust ä¸­çš„é”™è¯¯å¤„ç†",
    "description" : "&emsp;&emsp; -- å¼‚å¸¸/é”™è¯¯å¤„ç† 1 è¢«ç§°ä½œæ˜¯â€œç¬¬å››æµç¨‹æ§åˆ¶è¯­å¥â€ï¼Œåœ¨ç°ä»£ç¨‹åºè®¾è®¡ä¸­å‘æŒ¥ç€è¶Šæ¥è¶Šé‡è¦çš„ä½œç”¨ã€‚ä¸€èˆ¬çš„è¯­è¨€å–œæ¬¢ä½¿ç”¨ try...catch... è¯­å¥æ•æ‰å¼‚å¸¸ï¼Œè¿™æ ·åšçœ‹ä¼¼å¾ˆç¬¦åˆ",
    "inLanguage" : "zh-cn",
    "author" : "Mogeko",
    "creator" : "Mogeko",
    "publisher": "Mogeko",
    "accountablePerson" : "Mogeko",
    "copyrightHolder" : "Mogeko",
    "copyrightYear" : "2019",
    "datePublished": "2019-01-23 12:50:59 &#43;0800 &#43;0800",
    "dateModified" : "2019-01-23 12:50:59 &#43;0800 &#43;0800",
    "url" : "https://mogeko.me/2019/044/",
    "wordCount" : "2921",
    "keywords" : [ "Rust", "Mogeko`s Blog"]
}
</script>

  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-104502658-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-104502658-2');
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://mogeko.me">Mogeko`s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/tools/" title="">Tools</a>
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a class="menu-item" href="/about/" title="Mogeko">Mogeko</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://mogeko.me">Mogeko`s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/tools/" title="">Tools</a>
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a class="menu-item" href="/about/" title="Mogeko">Mogeko</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Rust ä¸­çš„é”™è¯¯å¤„ç†</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://mogeko.me" rel="author">Mogeko</a> with â™¥ 
                <span class="post-time">
                on <time datetime=2019-01-23 itemprop="datePublished">January 23, 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://mogeko.me/categories/%E5%85%B3%E4%BA%8E%E7%BC%96%E7%A8%8B/"> å…³äºç¼–ç¨‹ </a>
                        
                </span>
                <span class="post-word-count">, 2921 words</span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          

<!-- 
<img alt="" src="https://mogeko.github.io/images/044/" >
<span class="spoiler" ></span>
&emsp;&emsp;
 -->

<p>å¼‚å¸¸/é”™è¯¯å¤„ç† <a href="#sup1"><sup>1</sup></a> è¢«ç§°ä½œæ˜¯<strong>â€œç¬¬å››æµç¨‹æ§åˆ¶è¯­å¥â€</strong>ï¼Œåœ¨ç°ä»£ç¨‹åºè®¾è®¡ä¸­å‘æŒ¥ç€è¶Šæ¥è¶Šé‡è¦çš„ä½œç”¨ã€‚ä¸€èˆ¬çš„è¯­è¨€å–œæ¬¢ä½¿ç”¨ <code>try...catch...</code> è¯­å¥æ•æ‰å¼‚å¸¸ï¼Œè¿™æ ·åšçœ‹ä¼¼å¾ˆç¬¦åˆé€»è¾‘ï¼Œå´å¾ˆéš¾å°†ä»£ç å†™å¾—ä¼˜é›…ï¼šå¦‚æœåœ¨å¼‚å¸¸æŠ›å‡ºå¤„å¤„ç†ï¼Œå®¹æ˜“ç ´åä¸šåŠ¡é€»è¾‘çš„å®Œæ•´æ€§ï¼Œä¸ä¼˜é›…ï¼›å¦‚æœå°†æ‰€æœ‰çš„å¼‚å¸¸æ”¾åœ¨ä¸€èµ·ç»Ÿä¸€å¤„ç†ï¼Œåˆå®¹æ˜“å‡ºç°å¿˜è®°å¤„ç†çš„æƒ…å†µã€‚æ‰€ä»¥å¦‚ä½•å¤„ç†å¼‚å¸¸ï¼Œä½•æ—¶å¤„ç†å¼‚å¸¸æ˜¯ä¸€ä»¶éå¸¸è€ƒéªŒç¨‹åºå‘˜ç»éªŒçš„äº‹æƒ…ã€‚ä½† Rust å°±ä¸åŒäº†ã€‚</p>

<p>Rust ä¸­çš„é”™è¯¯å¤„ç†æ–¹å¼æ˜¯æˆ‘è§è¿‡æœ€ä¼˜é›…çš„ã€‚Rust ä¸­å¹¶æ²¡æœ‰å¼‚å¸¸ï¼Œè€Œä¸»è¦æ˜¯ä½¿ç”¨ä¸€ç§åä¸º <code>Result</code> (å®é™…ä¸Šæ˜¯ä¸€ç§æšä¸¾) çš„æ¦‚å¿µå¤„ç†é”™è¯¯ã€‚å®ƒçš„å¥½å¤„å°±åœ¨äºä¸ä¼šå½±å“ä¸šåŠ¡é€»è¾‘ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æ˜¯ä¸šåŠ¡é€»è¾‘çš„ä¸€éƒ¨åˆ†ï¼</p>

<p>Rust ä¸­ï¼Œæœ‰ä¸¤ç§é”™è¯¯ï¼š</p>

<ul>
<li><strong>å¯æ¢å¤é”™è¯¯</strong> (<em>recoverable</em>)</li>
<li><strong>ä¸å¯æ¢å¤é”™è¯¯</strong> (<em>unrecoverable</em>)</li>
</ul>

<p>å¤§éƒ¨åˆ†è¯­è¨€ä¸åŒºåˆ†è¿™ä¸¤ç±»é”™è¯¯ï¼Œå¹¶ä½¿ç”¨ç›¸ä¼¼çš„é€»è¾‘å¤„ç†ä»–ä»¬ã€‚Rust ä½¿ç”¨ <code>Result</code> å’Œ <code>panic!</code> å¤„ç†å¯æ¢å¤é”™è¯¯ï¼Œåœ¨é‡åˆ°ä¸å¯æ¢å¤é”™è¯¯æ—¶ç›´æ¥ä½¿ç”¨ <code>panic!</code> åœæ­¢ç¨‹åºæ‰§è¡Œã€‚</p>

<p><img alt="Rust ä¸­çš„é”™è¯¯ç±»å‹" src="https://mogeko.github.io/images/044/type_0f_wrong.png" ></p>

<p>å…ˆæ¥è§£é‡Šä¸€ä¸‹ <code>panic!</code>ã€‚</p>

<p><i id="sup1" style="color: #989898"><sup>1</sup> <strong>å¼‚å¸¸</strong>å’Œ<strong>é”™è¯¯</strong>æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè¿™é‡Œåªæ¯”è¾ƒä»–ä»¬çš„ç›¸ä¼¼æ€§ï¼Œä¸å¤šåšåŒºåˆ†ã€‚</i></p>

<h1 id="panic">panic!</h1>

<p><code>panic!</code> å¤„ç†é”™è¯¯æ—¶ä¼šé‡‡ç”¨<strong>å±•å¼€</strong> (unwinding) å’Œ<strong>ç»ˆæ­¢</strong> (abort) ä¸¤ç§ç­–ç•¥å¤„ç†æ ˆä¸Šçš„æ•°æ®ã€‚</p>

<p>å±•å¼€çš„æ„æ€å°±æ˜¯è¯´ Rust ä¼šå›æº¯æ ˆå¹¶ä¸€å±‚ä¸€å±‚çš„æ¸…ç†å®ƒé‡åˆ°çš„æ¯ä¸€ä¸ªå‡½æ•°çš„æ•°æ®ï¼Œå°±åƒè¿™æ ·ï¼š</p>

<pre><code class="language-bash">    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/panic`
thread 'main' panicked at 'index out of bounds: the len is 3 but the index is 99', /checkout/src/liballoc/vec.rs:1555:10
stack backtrace:
   0: std::sys:ğŸ‘¿:backtrace::tracing:ğŸ‘¿:unwind_backtrace
             at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49
   1: std::sys_common::backtrace::_print
             at /checkout/src/libstd/sys_common/backtrace.rs:71
   2: std::panicking::default_hook::{{closure}}
             at /checkout/src/libstd/sys_common/backtrace.rs:60
             at /checkout/src/libstd/panicking.rs:381
   3: std::panicking::default_hook
             at /checkout/src/libstd/panicking.rs:397
   4: std::panicking::rust_panic_with_hook
             at /checkout/src/libstd/panicking.rs:611
   5: std::panicking::begin_panic
             at /checkout/src/libstd/panicking.rs:572
   6: std::panicking::begin_panic_fmt
             at /checkout/src/libstd/panicking.rs:522
   7: rust_begin_unwind
             at /checkout/src/libstd/panicking.rs:498
   8: core::panicking::panic_fmt
             at /checkout/src/libcore/panicking.rs:71
   9: core::panicking::panic_bounds_check
             at /checkout/src/libcore/panicking.rs:58
  10: &lt;alloc::vec::Vec&lt;T&gt; as core::ops::index::Index&lt;usize&gt;&gt;::index
             at /checkout/src/liballoc/vec.rs:1555
  11: panic::main
             at src/main.rs:4
  12: __rust_maybe_catch_panic
             at /checkout/src/libpanic_unwind/lib.rs:99
  13: std::rt::lang_start
             at /checkout/src/libstd/panicking.rs:459
             at /checkout/src/libstd/panic.rs:361
             at /checkout/src/libstd/rt.rs:61
  14: main
  15: __libc_start_main
  16: &lt;unknown&gt;
</code></pre>

<p>æ˜¯ä¸æ˜¯å¾ˆåƒå¼‚å¸¸ï¼ŸRust é»˜è®¤ä½¿ç”¨å±•å¼€çš„ç­–ç•¥æ¸…ç†å†…å­˜ï¼Œä¸è¿‡å±•å¼€å †æ ˆéœ€è¦é¢å¤–è®°å½•å †æ ˆä¿¡æ¯ï¼Œè¿™ä¼šå¯¹äºŒè¿›åˆ¶ç¨‹åºçš„å¤§å°ä»¥åŠæ‰§è¡Œæ•ˆç‡ (å¾®ä¹å…¶å¾®) äº§ç”Ÿå½±å“ã€‚</p>

<p>å¦ä¸€ç§é€‰æ‹©æ˜¯ç›´æ¥ç»ˆæ­¢ï¼Œè¿™ä¼šä¸æ¸…ç†æ•°æ®å°±ç›´æ¥é€€å‡ºã€‚å‰©ä¸‹çš„ä¸€å †çƒ‚æ‘Šå­æ‰”ç»™æ“ä½œç³»ç»Ÿæ¥å¤„ç†ã€‚</p>

<p>å±•å¼€å †æ ˆæ—¶å¯ä»¥ç”¨ <code>std::panic::catch_unwind</code> æ•è· <code>panic</code> æŠ›å‡ºçš„å †æ ˆï¼Œä½†æ˜¯<strong>æä¸</strong>æ¨èç”¨è¿™ç§æ–¹æ³•æ¥å¤„ç†é”™è¯¯ã€‚<code>catch_unwind</code> ä¸€èˆ¬æ˜¯ç”¨æ¥åœ¨å¤šçº¿ç¨‹ç¨‹åºé‡Œé¢åœ¨å°†æŒ‚æ‰çš„çº¿ç¨‹ catch ä½ï¼Œé˜²æ­¢ä¸€ä¸ªçº¿ç¨‹æŒ‚æ‰å¯¼è‡´æ•´ä¸ªè¿›ç¨‹å´©æ‰ï¼Œæˆ–è€…æ˜¯é€šè¿‡å¤–éƒ¨å‡½æ•°æ¥å£ (FFI) ä¸ C äº¤äº’æ—¶å°†å †æ ˆä¿¡æ¯å…œä½é˜²æ­¢ C ç¨‹åºçœ‹åˆ°å †æ ˆä¸çŸ¥é“å¦‚ä½•å¤„ç†ã€‚å¦å¤–å¹¶ä¸æ˜¯æ‰€æœ‰ç¨‹åºéƒ½èƒ½ç”¨ <code>catch_unwind</code> æ•æ‰ï¼Œæœ‰çš„åµŒå…¥å¼å¹³å°ä¸Šçš„ç¨‹åºå—é™äºäºŒè¿›åˆ¶æ–‡ä»¶å¤§å°çš„é™åˆ¶ï¼Œ<code>panic</code> æ²¡æœ‰ä½¿ç”¨å±•å¼€ï¼Œè€Œæ˜¯ä½¿ç”¨ç»ˆæ­¢çš„æ–¹å¼é€€å‡ºç¨‹åºï¼Œè¿™å°±æ²¡æ³•å…œå¾—ä½äº†ã€‚</p>

<h1 id="result">Result</h1>

<p>å°±ä¸‹æ¥ä»‹ç»ä¸€ç§æ›´å¸¸ç”¨ä¹Ÿæ˜¯æˆ‘æœ€å–œæ¬¢çš„ä¸€ç§é”™è¯¯å¤„ç†æ–¹å¼ï¼š<code>Result</code> ç±»å‹ã€‚</p>

<p><code>Result</code> çš„æœ¬è´¨æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯æšä¸¾ã€‚</p>

<h2 id="result-ä¸æšä¸¾">Result ä¸æšä¸¾</h2>

<p>æšä¸¾æ˜¯ Rust ç‰¹æœ‰çš„ä¸€ç§ç±»å‹ï¼Œä¸ F#ã€OCaml å’Œ Haskell è¿™æ ·çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­çš„<strong>ä»£æ•°æ•°æ®ç±»å‹</strong> (<em>algebraic data types</em>) æœ€ä¸ºç›¸ä¼¼ã€‚</p>

<p><code>Result</code> æ˜¯ Rust è‡ªå¸¦çš„ä¸€ä¸ªå·²ç»å®šä¹‰å¥½äº†çš„æšä¸¾ã€‚<code>Result</code> ä¸­å®šä¹‰äº†ä¸¤ä¸ªæˆå‘˜ï¼š</p>

<pre><code class="language-rust">enum Result&lt;T, E&gt; {
    Ok(T),
    Err(E),
}
</code></pre>

<p><code>OK</code> è¡¨ç¤ºæˆåŠŸçš„æƒ…å†µï¼Œ<code>Err</code> è¡¨ç¤ºå‡ºé”™çš„æƒ…å†µ (<code>T</code> å’Œ <code>E</code> åˆ†åˆ«è¡¨ç¤º <code>OK</code> æˆ– <code>Err</code> ä¸­æ•°æ®çš„ç±»å‹)ã€‚å¦‚æœä½ è°ƒç”¨äº†ä¸€ä¸ªå¯èƒ½ä¼šå‡ºé”™çš„å‡½æ•°ï¼Œé‚£ä¹ˆå‡½æ•°å°†ä¼šè¿”å›ä¸€ä¸ª <code>Result</code> æšä¸¾ã€‚ä¸€ä¸ªæšä¸¾å®ä¾‹è¡¨ç¤ºæšä¸¾ç±»å‹å®šä¹‰çš„æˆå‘˜ä¸­çš„<strong>ä»»æ„</strong>ä¸€é¡¹ï¼Œåæ˜ åˆ° <code>Result</code> ä¸Šå°±æ˜¯ <code>OK</code> æˆ– <code>Err</code>ã€‚ä¹Ÿå°±æ˜¯è¯´å‡½æ•°è¿”å›çš„ <code>Result</code> æ—¢å¯èƒ½æ˜¯ä¸€ä¸ªåŒ…å« <code>OK</code> çš„ <code>Result</code>ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªåŒ…å« <code>Err</code> çš„ <code>Result</code>ï¼Œè¿™æœ‰ç‚¹ç±»ä¼¼äºâ€œè–›å®šè°”çš„çŒ«â€â€”â€”å¤„äºç”Ÿä¸æ­»çš„å åŠ æ€â€”â€”å¯ä»¥è¯´ <code>Result</code> å¤„äº <code>OK</code> ä¸ <code>Err</code> çš„â€œå åŠ æ€â€ã€‚</p>

<p>é‚£ä¹ˆè¿™åˆæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p>

<p><code>Result</code> çš„ä¼˜è¶Šæ€§å°±åœ¨äºï¼šæ— è®ºç¨‹åºå‡ºé”™ä¸å¦ï¼Œ<strong>å‡½æ•°è¿”å›çš„å€¼çš„ç±»å‹å§‹ç›¸åŒçš„ï¼</strong>å‡½æ•°çš„è°ƒç”¨è€…å¯ä»¥é‡‡ç”¨ç›¸åŒçš„æ–¹å¼è¡Œäº‘æµæ°´èˆ¬çš„å¤„ç† <code>Result</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºæˆåŠŸä¸å¦ï¼Œå‡½æ•°çš„è°ƒç”¨è€…éƒ½è¦å¤„ç† <code>Result</code>ï¼Œé”™è¯¯å¤„ç†æˆä¸ºäº†ä¸šåŠ¡é€»è¾‘çš„ä¸€éƒ¨åˆ†ã€‚</p>

<h2 id="å¤„ç†é”™è¯¯">å¤„ç†é”™è¯¯</h2>

<p>æˆ‘ä»¬å·²ç»æˆåŠŸçš„è·å¾—äº†ä»è°ƒç”¨çš„å‡½æ•°æ‰‹é‡Œè¿”å›çš„ <code>Result</code>ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æ‰§è¡Œåˆ°åº•æœ‰æ²¡æœ‰æˆåŠŸã€‚è¿™æ—¶æˆ‘ä»¬å°±åº”è¯¥å¼€å§‹å¤„ç†é”™è¯¯äº†ã€‚</p>

<h3 id="unwrap-ä¸-expect">unwrap ä¸ expect</h3>

<p>æˆ‘ä»¬å…ˆçœ‹è¿™ä¹ˆä¸€ä¸ªä¾‹å­ï¼š</p>

<pre><code class="language-rust">use std::fs::File;

fn main() {
    let f1 = File::open(&quot;hello.txt&quot;).unwrap();
    let f2 = File::open(&quot;hello.txt&quot;).expect(&quot;Failed to open hello.txt&quot;);
}
</code></pre>

<p>ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>File::open</code> æ¥è¯»æ‰“å¼€ä¸€ä¸ªåä¸º <code>hello.txt</code> çš„æ–‡ä»¶ã€‚å‡½æ•° <code>File::open</code> å°†ä¼šè¿”å›ä¸€ä¸ª <code>io::Result</code>ã€‚Rust æ ‡å‡†åº“ä¸­æœ‰å¾ˆå¤šå«åš <code>Result</code> çš„ç±»å‹ï¼Œ<code>io::Result</code> æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå¹¶ä¸” <code>io::Result</code> çš„å®ä¾‹æ‹¥æœ‰ <code>unwrap</code> æ–¹æ³•å’Œ <code>expect</code> æ–¹æ³•ã€‚ å¦‚æœç¨‹åºæ‰§è¡ŒæˆåŠŸ <code>unwrap</code> æˆ– <code>expect</code> æ–¹æ³•ä¼šå°†æ­£ç¡®çš„å€¼å–å‡ºæ¥ï¼Œå¦‚æœå‡ºé”™å°±ç›´æ¥è®©ç¨‹åºæŒ‚æ‰ã€‚å…¶ä¸­ <code>unwrap</code> æ–¹æ³•åœ¨æŒ‚æ‰æ—¶ä¼šæ‰“å°å‡ºæ ‡å‡†åº“å†…ç½®çš„é”™è¯¯ä¿¡æ¯ï¼Œè€Œ <code>exprct</code> åˆ™è®©æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²åœ¨ç¨‹åºæŒ‚æ‰æ—¶æ˜¾ç¤ºã€‚</p>

<p><code>unwrap</code> /<code>expect</code> å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é”™è¯¯å¤„ç†æ–¹å¼ã€‚ <strong><code>unwrap</code> å’Œ <code>expect</code> åªä¼šæ•æ‰é”™è¯¯ï¼Œç„¶åç»ˆæ­¢ç¨‹åºï¼Œå¹¶æ²¡æœ‰çœŸæ­£çš„å¤„ç†é”™è¯¯ã€‚</strong>æ‰€ä»¥ <code>unwrap</code> å’Œ <code>expect</code> ä¸€èˆ¬åªæ˜¯ç”¨äºåŸå‹è®¾è®¡ã€‚</p>

<h3 id="match">match</h3>

<p>ä½¿ç”¨ <code>match</code> æ¥å¤„ç†é”™è¯¯æ˜¯æœ€å¸¸ç”¨ï¼Œä¹Ÿæ˜¯æœ€æ¨å´‡çš„åšæ³•ã€‚è¿˜æ˜¯åˆšåˆšçš„é‚£ä¸ªä¾‹å­ï¼Œå¦‚æœç”¨ <code>match</code> æ¥å†™çš„è¯ï¼š</p>

<pre><code class="language-rust">use std::fs::File;

fn main() {
    let f = File::open(&quot;hello.txt&quot;);

    let f = match f {
        Ok(file) =&gt; file,
        Err(error) =&gt; {
            panic!(&quot;There was a problem opening the file: {:?}&quot;, error)
        },
    };
}
</code></pre>

<p>å¯ä»¥æŠŠ <code>match</code> è¡¨è¾¾å¼æƒ³è±¡æˆæŸç§ç¡¬å¸åˆ†ç±»å™¨ï¼šç¡¬å¸æ»‘å…¥æœ‰ç€ä¸åŒå¤§å°å­”æ´çš„è½¨é“ï¼Œæ¯ä¸€ä¸ªç¡¬å¸éƒ½ä¼šæ‰å…¥ç¬¦åˆå®ƒå¤§å°çš„å­”æ´ã€‚åŒæ ·åœ°ï¼Œå€¼ä¹Ÿä¼šé€šè¿‡ <code>match</code> çš„æ¯ä¸€ä¸ªæ¨¡å¼ï¼Œå¹¶ä¸”åœ¨é‡åˆ°ç¬¬ä¸€ä¸ª â€œç¬¦åˆâ€ çš„æ¨¡å¼æ—¶ï¼Œå€¼ä¼šè¿›å…¥ç›¸å…³è”çš„ä»£ç å—å¹¶åœ¨æ‰§è¡Œä¸­è¢«ä½¿ç”¨ã€‚</p>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>f</code> å°±æ˜¯é‚£ä¸ªç¡¬å¸ï¼Œ<code>OK</code> å’Œ <code>Err</code> å°±æ˜¯é‚£ä¸ªå­”ï¼›<code>match</code> ä¼šæŠŠ <code>f</code> (<code>io::Result</code>) å®ä¾‹ä¸­å€¼çš„ç±»å‹ä¸ <code>OK</code> ã€<code>Err</code> åšåŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ°äº†åˆé€‚çš„ç±»å‹å°±æ‰§è¡Œ <code>=&gt;</code> åçš„è¡¨è¾¾å¼ã€‚å½“ç»“æœæ˜¯ <code>Ok</code> æ—¶ï¼Œè¿”å› <code>Ok</code> æˆå‘˜ä¸­çš„ <code>file</code> å€¼ï¼Œç„¶åå°†è¿™ä¸ªæ–‡ä»¶å¥æŸ„èµ‹å€¼ç»™å˜é‡ <code>f</code>ã€‚å½“ç»“æœæ˜¯ <code>Err</code> æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹©è°ƒç”¨ <code>panic!</code>å®ã€‚</p>

<h2 id="åŒ¹é…ä¸åŒçš„é”™è¯¯">åŒ¹é…ä¸åŒçš„é”™è¯¯</h2>

<p>ä¸Šæ–‡çš„ä»£ç ä¸ç®¡ <code>File::open</code> æ˜¯å› ä¸ºä»€ä¹ˆåŸå› å¤±è´¥éƒ½ä¼š <code>panic!</code>ã€‚æˆ‘ä»¬çœŸæ­£å¸Œæœ›çš„æ˜¯å¯¹ä¸åŒçš„é”™è¯¯åŸå› é‡‡å–ä¸åŒçš„è¡Œä¸ºï¼šå¦‚æœ <code>File::open</code>å› ä¸ºæ–‡ä»¶ä¸å­˜åœ¨è€Œå¤±è´¥ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ›å»ºè¿™ä¸ªæ–‡ä»¶å¹¶è¿”å›æ–°æ–‡ä»¶çš„å¥æŸ„ã€‚å¦‚æœ <code>File::open</code> å› ä¸ºä»»ä½•å…¶ä»–åŸå› å¤±è´¥ï¼Œä¾‹å¦‚æ²¡æœ‰æ‰“å¼€æ–‡ä»¶çš„æƒé™ï¼Œæˆ‘ä»¬ä»ç„¶å¸Œæœ› <code>panic!</code>ã€‚</p>

<p>åªéœ€è¦å¢åŠ ä¸€ä¸ª <code>match</code> å°±å¯ä»¥äº†ï¼š</p>

<pre><code class="language-rust">use std::fs::File;
use std::io::ErrorKind;

fn main() {
    let f = File::open(&quot;hello.txt&quot;);

    let f = match f {
        Ok(file) =&gt; file,
        Err(error) =&gt; match error.kind() {
            ErrorKind::NotFound =&gt; match File::create(&quot;hello.txt&quot;) {
                Ok(fc) =&gt; fc,
                Err(e) =&gt; panic!(&quot;Tried to create file but there was a problem: {:?}&quot;, e),
            },
            other_error =&gt; panic!(&quot;There was a problem opening the file: {:?}&quot;, other_error),
        },
    };
}
</code></pre>

<p>å¦‚æœè§‰å¾—å¤ªéº»çƒ¦äº†ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é—­åŒ…ï¼š</p>

<pre><code class="language-rust">use std::fs::File;
use std::io::ErrorKind;

fn main() {
    let f = File::open(&quot;hello.txt&quot;).map_err(|error| {
        if error.kind() == ErrorKind::NotFound {
            File::create(&quot;hello.txt&quot;).unwrap_or_else(|error| {
                panic!(&quot;Tried to create file but there was a problem: {:?}&quot;, error);
            })
        } else {
            panic!(&quot;There was a problem opening the file: {:?}&quot;, error);
        }
    });
}
</code></pre>

<h2 id="ä¼ æ’­é”™è¯¯">ä¼ æ’­é”™è¯¯</h2>

<p>Rust å…è®¸ç¨‹åºåƒåˆ«çš„è¯­è¨€å¤„ç†â€œå¼‚å¸¸â€ä¸€æ ·çš„å°†é”™è¯¯æ‰”ç»™æ›´ä¸Šä¸€å±‚çš„è°ƒç”¨è€…ï¼Œè¿™è¢«ç§°ä¸º<strong>ä¼ æ’­</strong> (propagating)é”™è¯¯ã€‚</p>

<p>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸èƒ½è¯»å–ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå°†è¿™äº›é”™è¯¯è¿”å›ç»™è°ƒç”¨å®ƒçš„ä»£ç ï¼š</p>

<pre><code class="language-rust">use std::io;
use std::io::Read;
use std::fs::File;

fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {
    let f = File::open(&quot;hello.txt&quot;);

    let mut f = match f {
        Ok(file) =&gt; file,
        Err(e) =&gt; return Err(e),
    };

    let mut s = String::new();

    match f.read_to_string(&amp;mut s) {
        Ok(_) =&gt; Ok(s),
        Err(e) =&gt; Err(e),
    }
}
</code></pre>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç¨‹åºä¼šå°è¯•æ‰“å¼€ä¸€ä¸ªåä¸º <code>hello.txt</code> çš„æ–‡ä»¶ï¼Œå¦‚æœå¤±è´¥å°†ä¼šæå‰è¿”å›ä¸€ä¸ªåŒ…å« <code>Err</code> çš„ <code>Result</code>ï¼›å¦‚æœæˆåŠŸï¼Œåˆ™å°†ä¼šå°è¯•è¯»å– <code>hello.txt</code> ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœæˆåŠŸåˆ™ä¼šè¿”å›åŒ…å«å‚¨å­˜äº†è¢«è¯»å–ä¿¡æ¯çš„ <code>String</code> çš„ <code>Result</code>ï¼Œå¦åˆ™è¿”å›åŒ…å« <code>Err</code> çš„ <code>Result</code>ã€‚</p>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>?</code> ç®€å†™ï¼š</p>

<pre><code class="language-rust">use std::io;
use std::io::Read;
use std::fs::File;

fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {
    let mut s = String::new();

    File::open(&quot;hello.txt&quot;)?.read_to_string(&amp;mut s)?;

    Ok(s)
}
</code></pre>

<p>è¿™æ®µä»£ç ä¸ä¸Šä¸€æ®µä»£ç çš„ä½œç”¨ç›¸åŒï¼šæ‰“å¼€æ–‡ä»¶ -&gt; è¯»å–æ–‡ä»¶ï¼›ä½†æ˜¯è¿™ä¸€æ®µä»£ç æ›´ç®€æ´ã€‚<code>File::open</code> è°ƒç”¨ç»“å°¾çš„ <code>?</code> å°†ä¼šè¿”å› <code>Ok</code> ä¸­çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶ <code>hello.txt</code> çš„æ–‡ä»¶å¥æŸ„ã€‚å¦‚æœå‡ºç°äº†é”™è¯¯ï¼Œ<code>?</code> ä¼šææ—©è¿”å›æ•´ä¸ªå‡½æ•°å¹¶å°†ä¸€äº› <code>Err</code> å€¼ä¼ æ’­ç»™è°ƒç”¨è€…ã€‚åŒç†ä¹Ÿé€‚ç”¨äº <code>read_to_string</code> è°ƒç”¨ç»“å°¾çš„ <code>?</code>ã€‚</p>

<p><code>match</code> è¡¨è¾¾å¼ä¸é—®å·è¿ç®—ç¬¦æ‰€åšçš„æœ‰ä¸€ç‚¹ä¸åŒï¼š<code>?</code> æ‰€ä½¿ç”¨çš„é”™è¯¯å€¼è¢«ä¼ é€’ç»™äº† <code>from</code> å‡½æ•°ï¼Œå®ƒå®šä¹‰äºæ ‡å‡†åº“çš„ <code>From</code> trait ä¸­ï¼Œå…¶ç”¨æ¥å°†é”™è¯¯ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚å½“ <code>?</code> è°ƒç”¨ <code>from</code> å‡½æ•°æ—¶ï¼Œæ”¶åˆ°çš„é”™è¯¯ç±»å‹è¢«è½¬æ¢ä¸ºå®šä¹‰ä¸ºå½“å‰å‡½æ•°è¿”å›çš„é”™è¯¯ç±»å‹ã€‚è¿™åœ¨å½“ä¸€ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªé”™è¯¯ç±»å‹æ¥ä»£è¡¨æ‰€æœ‰å¯èƒ½å¤±è´¥çš„æ–¹å¼æ—¶å¾ˆæœ‰ç”¨ï¼Œå³ä½¿å…¶å¯èƒ½ä¼šå› å¾ˆå¤šç§åŸå› å¤±è´¥ã€‚åªè¦æ¯ä¸€ä¸ªé”™è¯¯ç±»å‹éƒ½å®ç°äº† <code>from</code> å‡½æ•°æ¥å®šä¹‰å¦‚å°†å…¶è½¬æ¢ä¸ºè¿”å›çš„é”™è¯¯ç±»å‹ï¼Œ<code>?</code> ä¼šè‡ªåŠ¨å¤„ç†è¿™äº›è½¬æ¢ã€‚</p>

<p><strong><code>?</code> åªèƒ½è¢«ç”¨äºè¿”å› <code>Result</code> çš„å‡½æ•°</strong></p>

<p><br></p>

<p><center>  Â·EndÂ·  </center></p>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Mogeko </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://mogeko.me/2019/044/>https://mogeko.me/2019/044/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                æœ¬æ–‡é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://mogeko.me/tags/rust/">
                    #Rust</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> Â· 
                <span><a href="https://mogeko.me">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://mogeko.me/2019/043/" class="prev" rel="prev" title="The Little Printf"><i class="iconfont icon-left"></i>&nbsp;The Little Printf</a>
         
        
        <a href="https://mogeko.me/2019/045/" class="next" rel="next" title="æ‰å¹³å®ç®±æ’ç”»">æ‰å¹³å®ç®±æ’ç”»&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
        
<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '936cecdd2ab935870ca5',
        clientSecret: '39cfc7a3cb9a974b6609f3fdaa637e2917e3e40a',
        repo: 'Blog',
        owner: 'Mogeko',
        admin: ['Mogeko'],
        id: location.pathname, 
        distractionFreeMode: false 
    });
    (function () {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
            return;
        }
        gitalk.render('gitalk-container');
    })();
</script>

    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2017 - 2019</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://mogeko.me">Mogeko</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
